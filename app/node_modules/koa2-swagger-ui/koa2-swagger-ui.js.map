{"version":3,"file":"koa2-swagger-ui.js","sources":["../lib/index.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as Handlebars from 'handlebars';\nimport { defaultsDeep } from 'lodash';\nimport * as path from 'path';\nimport * as readPkgUp from 'read-pkg-up';\n\nexport interface SwaggerOptions {\n  dom_id: string;\n  url: string;\n  supportedSubmitMethods: string[];\n  docExpansion: string;\n  jsonEditor: boolean;\n  defaultModelRendering: string;\n  showRequestHeaders: boolean;\n  layout: string;\n  [key: string]: string | boolean | string[];\n}\n\nexport interface KoaSwaggerUiOptions {\n  title: string;\n  oauthOptions: boolean | any;\n  swaggerOptions: Partial<SwaggerOptions>;\n  swaggerVersion: string;\n  routePrefix: string | false;\n  hideTopbar: boolean;\n  favicon16: string;\n  favicon32: string;\n}\n\nconst defaultOptions: KoaSwaggerUiOptions = {\n  title: 'Swagger UI',\n  oauthOptions: false,\n  swaggerOptions: {\n    dom_id: '#swagger-ui',\n    url: 'https://petstore.swagger.io/v2/swagger.json',\n    layout: 'StandaloneLayout',\n  },\n  routePrefix: '/docs',\n  swaggerVersion: '',\n  hideTopbar: false,\n  favicon16: '/favicon-16x16.png',\n  favicon32: '/favicon-32x32.png',\n};\n\nfunction koaSwagger(config: Partial<KoaSwaggerUiOptions> = {}) {\n  if (!config.swaggerVersion) {\n    const pkg: any = readPkgUp.sync({ cwd: __dirname }).pkg;\n    defaultOptions.swaggerVersion = pkg.devDependencies['swagger-ui-dist'];\n  }\n  // Setup icons\n  const extFavicon16 = config.favicon16;\n  const extFavicon32 = config.favicon32;\n  const favicon16Path = path.join(__dirname, defaultOptions.favicon16);\n  const favicon32Path = path.join(__dirname, defaultOptions.favicon32);\n\n  // Setup default options\n  const options = defaultsDeep(config, defaultOptions);\n  Handlebars.registerHelper('json', context => JSON.stringify(context));\n  Handlebars.registerHelper('strfnc', fnc => fnc);\n  Handlebars.registerHelper('isset', function(this: any, conditional, opt) {\n    return conditional ? opt.fn(this) : opt.inverse(this);\n  });\n  const index = Handlebars.compile(fs.readFileSync(path.join(__dirname, './index.hbs'), 'utf-8'));\n\n  // tslint:disable-next-line:no-unused\n  return function koaSwaggerUi(ctx, next) {\n    if (options.routePrefix === false || ctx.path === options.routePrefix) {\n      ctx.type = 'text/html';\n      ctx.body = index(options);\n      return true;\n    }\n    if (!extFavicon16 && ctx.path === defaultOptions.favicon16) {\n      ctx.type = 'image/png';\n      ctx.body = fs.createReadStream(favicon16Path);\n      return true;\n    }\n    if (!extFavicon32 && ctx.path === defaultOptions.favicon32) {\n      ctx.type = 'image/png';\n      ctx.body = fs.createReadStream(favicon32Path);\n      return true;\n    }\n    return next();\n  };\n}\n\nexport default koaSwagger;\n"],"names":["readPkgUp.sync","path.join","defaultsDeep","Handlebars.registerHelper","Handlebars.compile","fs.readFileSync","fs.createReadStream"],"mappings":";;;;;;AA6BA,MAAM,iBAAsC;IAC1C,OAAO,YADmC;IAE1C,cAAc,KAF4B;IAG1C,gBAAgB;QACd,QAAQ,aADM;QAEd,KAAK,6CAFS;QAGd,QAAQ;KANgC;IAQ1C,aAAa,OAR6B;IAS1C,gBAAgB,EAT0B;IAU1C,YAAY,KAV8B;IAW1C,WAAW,oBAX+B;IAY1C,WAAW;;AAGb,oBAAoB,MAAA,GAAuC;IACzD,IAAI,CAAC,MAAA,CAAO,gBAAgB;QAC1B,MAAM,MAAWA,cAAA,CAAe;YAAE,KAAK;UAAtB,CAAmC;QACpD,cAAA,CAAe,cAAf,GAAgC,GAAA,CAAI,eAAJ,CAAoB;;IAGtD,MAAM,eAAe,MAAA,CAAO;IAC5B,MAAM,eAAe,MAAA,CAAO;IAC5B,MAAM,gBAAgBC,SAAA,CAAU,WAAW,cAAA,CAAe;IAC1D,MAAM,gBAAgBA,SAAA,CAAU,WAAW,cAAA,CAAe;IAG1D,MAAM,UAAUC,mBAAA,CAAa,QAAQ;IACrCC,yBAAA,CAA0B,QAAQ,OAAA,IAAW,IAAA,CAAK,SAAL,CAAe;IAC5DA,yBAAA,CAA0B,UAAU,GAAA,IAAO;IAC3CA,yBAAA,CAA0B,SAAS,UAAoB,WAAa,EAAA;QAClE,OAAO,WAAA,GAAc,GAAA,CAAI,EAAJ,CAAO,QAAQ,GAAA,CAAI,OAAJ,CAAY;;IAElD,MAAM,QAAQC,kBAAA,CAAmBC,eAAA,CAAgBJ,SAAA,CAAU,WAAW,gBAAgB;IAGtF,OAAO,sBAAsB,GAAK,EAAA;QAChC,IAAI,OAAA,CAAQ,WAAR,KAAwB,KAAxB,IAAiC,GAAA,CAAI,IAAJ,KAAa,OAAA,CAAQ,aAAa;YACrE,GAAA,CAAI,IAAJ,GAAW;YACX,GAAA,CAAI,IAAJ,GAAW,KAAA,CAAM;YACjB,OAAO;;QAET,IAAI,CAAC,YAAD,IAAiB,GAAA,CAAI,IAAJ,KAAa,cAAA,CAAe,WAAW;YAC1D,GAAA,CAAI,IAAJ,GAAW;YACX,GAAA,CAAI,IAAJ,GAAWK,mBAAA,CAAoB;YAC/B,OAAO;;QAET,IAAI,CAAC,YAAD,IAAiB,GAAA,CAAI,IAAJ,KAAa,cAAA,CAAe,WAAW;YAC1D,GAAA,CAAI,IAAJ,GAAW;YACX,GAAA,CAAI,IAAJ,GAAWA,mBAAA,CAAoB;YAC/B,OAAO;;QAET,OAAO,IAAA;;;;;;"}